presubmits:
  kubernetes/kubernetes:
  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    skip_branches:
    - release-1.10  # per-release image
    - release-1.9  # per-release image
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --scenario=kubernetes_e2e
        - --
        - --build=bazel
        - --cluster=
        - --env-file=jobs/env/pull-kubernetes-e2e.env
        - --env-file=jobs/env/pull-kubernetes-e2e-gce-device-plugin-gpu.env
        - --extract=local
        - --gcp-node-image=gci
        - --gcp-nodes=4
        - --gcp-project=k8s-jkns-pr-gce-gpus
        - --gcp-zone=us-west1-b
        - --ginkgo-parallel=30
        - --provider=gce
        - --stage=gs://kubernetes-release-pull/ci/pull-kubernetes-e2e-gce-device-plugin-gpu
        - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
        - --timeout=60m
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    branches:
    - release-1.10  # per-release image
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --scenario=kubernetes_e2e
        - --
        - --build=bazel
        - --cluster=
        - --env-file=jobs/env/pull-kubernetes-e2e.env
        - --env-file=jobs/env/pull-kubernetes-e2e-gce-device-plugin-gpu.env
        - --extract=local
        - --gcp-node-image=gci
        - --gcp-nodes=4
        - --gcp-project=k8s-jkns-pr-gce-gpus
        - --gcp-zone=us-west1-b
        - --ginkgo-parallel=30
        - --provider=gce
        - --stage=gs://kubernetes-release-pull/ci/pull-kubernetes-e2e-gce-device-plugin-gpu
        - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
        - --timeout=60m
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    branches:
    - release-1.9 # per-release image
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --scenario=kubernetes_e2e
        - --
        - --build=bazel
        - --cluster=
        - --env-file=jobs/env/pull-kubernetes-e2e.env
        - --env-file=jobs/env/pull-kubernetes-e2e-gce-device-plugin-gpu.env
        - --extract=local
        - --gcp-node-image=gci
        - --gcp-nodes=4
        - --gcp-project=k8s-jkns-pr-gce-gpus
        - --gcp-zone=us-west1-b
        - --ginkgo-parallel=30
        - --provider=gce
        - --stage=gs://kubernetes-release-pull/ci/pull-kubernetes-e2e-gce-device-plugin-gpu
        - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
        - --timeout=60m
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    skip_branches:
    - release-1.10  # per-release image
    - release-1.9  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --scenario=kubernetes_e2e
        - --
        - --build=bazel
        - --cluster=
        - --deployment=gke
        - --extract=local
        - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
        - --gcp-node-image=gci
        - --gcp-project=k8s-gke-gpu-pr
        - --gcp-zone=us-west1-b
        - --ginkgo-parallel=30
        - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
        - --gke-environment=test
        - --provider=gke
        - --stage=gs://kubernetes-release-dev/ci
        - --stage-suffix=pull-kubernetes-e2e-gke-device-plugin-gpu
        - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
        - --timeout=60m
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    branches:
    - release-1.10  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --scenario=kubernetes_e2e
        - --
        - --build=bazel
        - --cluster=
        - --deployment=gke
        - --extract=local
        - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
        - --gcp-node-image=gci
        - --gcp-project=k8s-gke-gpu-pr
        - --gcp-zone=us-west1-b
        - --ginkgo-parallel=30
        - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
        - --gke-environment=test
        - --provider=gke
        - --stage=gs://kubernetes-release-dev/ci
        - --stage-suffix=pull-kubernetes-e2e-gke-device-plugin-gpu
        - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
        - --timeout=60m
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    branches:
    - release-1.9  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --scenario=kubernetes_e2e
        - --
        - --build=bazel
        - --cluster=
        - --deployment=gke
        - --extract=local
        - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
        - --gcp-node-image=gci
        - --gcp-project=k8s-gke-gpu-pr
        - --gcp-zone=us-west1-b
        - --ginkgo-parallel=30
        - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
        - --gke-environment=test
        - --provider=gke
        - --stage=gs://kubernetes-release-dev/ci
        - --stage-suffix=pull-kubernetes-e2e-gke-device-plugin-gpu
        - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
        - --timeout=60m
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"

periodics:
# GCE
- name: ci-kubernetes-e2e-gce-device-plugin-gpu
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-device-plugin-gpu-beta
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-beta
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-device-plugin-gpu-stable1
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-stable1
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-device-plugin-gpu-stable2
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-stable2
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-beta-stable1-cluster-downgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env=TEST_ETCD_VERSION=3.0.17
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-stable1
      - --extract=ci/k8s-beta
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUClusterDowngrade\] --upgrade-target=ci/k8s-stable1 --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-master-stable1-cluster-downgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env=TEST_ETCD_VERSION=3.0.17
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-stable1
      - --extract=ci/latest
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUClusterDowngrade\] --upgrade-target=ci/k8s-stable1 --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-gpu-stable1
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-gpu.env
      - --extract=ci/k8s-stable1
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPU\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-beta-cluster-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-beta
      - --extract=ci/k8s-stable1
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUClusterUpgrade\] --upgrade-target=ci/k8s-beta --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-beta-master-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-beta
      - --extract=ci/k8s-stable1
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUMasterUpgrade\] --upgrade-target=ci/k8s-beta --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-master-cluster-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/latest
      - --extract=ci/k8s-stable1
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUClusterUpgrade\] --upgrade-target=ci/latest --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-master-master-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/latest
      - --extract=ci/k8s-stable1
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUMasterUpgrade\] --upgrade-target=ci/latest --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-gpu-stable2
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-gpu.env
      - --extract=ci/k8s-stable2
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--ginkgo.focus=\[Feature:GPU\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable2-stable1-cluster-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-stable1
      - --extract=ci/k8s-stable2
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUClusterUpgrade\] --upgrade-target=ci/k8s-stable1 --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable2-stable1-master-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --check-version-skew=false
      - --env=STORAGE_MEDIA_TYPE=application/vnd.kubernetes.protobuf
      - --env-file=jobs/env/ci-kubernetes-e2e-gce-device-plugin-gpu.env
      - --extract=ci/k8s-stable1
      - --extract=ci/k8s-stable2
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --provider=gce
      - --test_args=--kubectl-path=../../../../kubernetes_skew/cluster/kubectl.sh --minStartupPods=8 --ginkgo.skip=\[.+\]|Initializers|Dashboard
      - --timeout=150m
      - --upgrade_args=--ginkgo.focus=\[Feature:GPUMasterUpgrade\] --upgrade-target=ci/k8s-stable1 --upgrade-image=gci
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
# GKE
- name: ci-kubernetes-e2e-gke-device-plugin-gpu
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/latest
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-beta
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/k8s-beta
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-monitoring
  interval: 3h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/latest
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=1
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:StackdriverAcceleratorMonitoring\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/latest
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-p100,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100-beta
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/k8s-beta
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-p100,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100-stable1
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/k8s-stable1
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-p100,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100-stable2
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/k8s-stable2
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-p100,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-stable1
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/k8s-stable1
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-stable2
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --extract=ci/k8s-stable2
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-ubuntu
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      - --scenario=kubernetes_e2e
      - --
      - --check-leaked-resources
      - --deployment=gke
      - --env=NVIDIA_DRIVER_INSTALLER_DAEMONSET=https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset.yaml
      - --extract=ci/latest
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=ubuntu
      - --gcp-project-type=gpu-project
      - --gcp-zone=us-west1-b
      - --gke-create-command=container clusters create --accelerator=type=nvidia-tesla-k80,count=2
      - --gke-environment=test
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Feature:GPUDevicePlugin\] --minStartupPods=8
      - --timeout=180m
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
